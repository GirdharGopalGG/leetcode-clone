// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
    provider = "prisma-client"
    output   = "../src/generated/prisma"
}

datasource db {
    provider = "postgresql"
}

enum UserRole {
    User
    Admin
}

enum Difficulty {
    Easy
    Medium
    Hard
}

enum SubmissionStatus {
    Pending
    Accepted
    Rejected
}

enum TestcaseStatus {
    Pending
    Accepted
    TLE
    CompilationError
    WrongAnswer
}

model User {
    id          String       @id @default(cuid())
    email       String       @unique
    name        String?
    password    String
    role        UserRole     @default(User)
    createdAt   DateTime     @default(now())
    updatedAt   DateTime     @updatedAt
    submissions Submission[]
}

model Problem {
    id          String       @id @default(cuid())
    title       String
    description String
    hidden      Boolean      @default(true)
    slug        String       @unique
    solved      Int          @default(0)
    difficulty  Difficulty   @default(Easy)
    createdAt   DateTime     @default(now())
    updatedAt   DateTime     @updatedAt
    submissions Submission[]
    testcases   Testcase[]
}

model Submission {
    id         String           @id @default(cuid())
    userId     String
    problemId  String
    languageId Int
    createdAt  DateTime         @default(now())
    updatedAt  DateTime         @updatedAt
    code       String
    status     SubmissionStatus @default(Pending)
    time       Float?
    memory     Int?
    testcases  Testcase[]
    language   Language         @relation(fields: [languageId], references: [id])
    user       User             @relation(fields: [userId], references: [id])
    problem    Problem          @relation(fields: [problemId], references: [id])

    @@unique([userId, languageId, problemId])
}

model Testcase {
    id               String         @id @default(cuid())
    problemId        String
    input            String
    output           String
    status           TestcaseStatus @default(Pending)
    submissionId     String?
    submission       Submission?    @relation(fields: [submissionId], references: [id])
    createdAt        DateTime       @default(now())
    updatedAt        DateTime       @updatedAt
    judge0TrackingId String         @unique
    problem          Problem        @relation(fields: [problemId], references: [id])

    @@unique([problemId, submissionId])
}

model Language {
    id          Int          @id @default(autoincrement())
    name        String
    judge0Id    Int          @unique
    submissions Submission[]
    createdAt   DateTime     @default(now())
    updatedAt   DateTime     @updatedAt
}
